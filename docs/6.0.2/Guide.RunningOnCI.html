<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Running On CI · Detox</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Running On CI · Detox"/><meta property="og:type" content="website"/><meta property="og:url" content="https://wix.github.io/detox/index.html"/><meta property="og:description" content="&gt; When your test suite is finally ready, it should be set up to run automatically on your CI server on every git push. This will alert you if new changes to the app break existing functionality."/><link rel="shortcut icon" href="/detox/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/detox/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/detox/"><h2 class="headerTitle">Detox</h2></a><a href="/detox/versions.html"><h3>6.0.2</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/detox/docs/6.0.2/Introduction.GettingStarted.html" target="_self">Getting Started</a></li><li><a href="https://github.com/wix/detox" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Running On CI</h1></header><article><div><span><blockquote>
<p>When your test suite is finally ready, it should be set up to run automatically on your CI server on every git push. This will alert you if new changes to the app break existing functionality.</p>
</blockquote>
<p>Running detox on CI is not that different from running it locally. There are two main differences:</p>
<ol>
<li>We will test a release build rather than a debug build</li>
<li>We will tell Detox to shut down the simulator when test is over</li>
</ol>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" name="step-1-prepare-a-release-configuration-for-your-app"></a><a href="#step-1-prepare-a-release-configuration-for-your-app" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 1: Prepare a release configuration for your app</h2>
<p>We will need to create a <a href="/docs/APIRef.Configuration.md#device-configuration">release device configuration for Detox</a> inside <code>package.json</code> under the <code>detox</code> section.</p>
<p><strong>Example:</strong></p>
<pre><code class="hljs css json">"detox": {
  "configurations": {
    "ios.sim.release": {
      "binaryPath": "ios/build/Build/Products/Release-iphonesimulator/example.app",
      "build": "xcodebuild -project ios/example.xcodeproj -scheme example -configuration Release -sdk iphonesimulator -derivedDataPath ios/build",
      "type": "ios.simulator",
      "name": "iPhone 7"
    }
  }
}
</code></pre>
<blockquote>
<p>TIP: Notice that the name <code>example</code> above should be replaced with your actual project name.</p>
</blockquote>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" name="step-2-add-build-and-test-commands-to-your-ci-script"></a><a href="#step-2-add-build-and-test-commands-to-your-ci-script" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 2: Add build and test commands to your CI script</h2>
<p>Assuming your CI is executing some sort of shell script, add the following commands that should run inside the project root:</p>
<pre><code class="hljs css sh">detox build --configuration ios.sim.release
detox <span class="hljs-built_in">test</span> --configuration ios.sim.release --cleanup
</code></pre>
<blockquote>
<p>TIP: Adding <code>--cleanup</code> to the test command will make sure detox exits cleanly by shutting down the simulator when the test is over.</p>
</blockquote>
<p><br></p>
<h2><a class="anchor" aria-hidden="true" name="appendix"></a><a href="#appendix" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Appendix</h2>
<h3><a class="anchor" aria-hidden="true" name="running-detox-on-travis-ci-https-travis-ciorg"></a><a href="#running-detox-on-travis-ci-https-travis-ciorg" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>• Running Detox on <a href="https://travis-ci.org/">Travis CI</a></h3>
<p>Detox's own build is running on Travis, check out Detox's <a href="/.travis.yml">.travis.yml</a> file to see how it's done.</p>
<p>This is a simple example configuration to get you started with Detox on Travis:</p>
<pre><code class="hljs css yaml"><span class="hljs-attr">language:</span> <span class="hljs-string">objective-c</span>
<span class="hljs-attr">osx_image:</span> <span class="hljs-string">xcode8.3</span>

<span class="hljs-attr">branches:</span>
<span class="hljs-attr">  only:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">master</span>

<span class="hljs-attr">env:</span>
<span class="hljs-attr">  global:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">NODE_VERSION=stable</span>

<span class="hljs-attr">install:</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">brew</span> <span class="hljs-string">tap</span> <span class="hljs-string">wix/brew</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">brew</span> <span class="hljs-string">install</span> <span class="hljs-string">applesimutils</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">curl</span> <span class="hljs-bullet">-o-</span> <span class="hljs-attr">https://raw.githubusercontent.com/creationix/nvm/v0.33.2/install.sh</span> <span class="hljs-string">| bash
- export NVM_DIR="$HOME/.nvm" &amp;&amp; [ -s "$NVM_DIR/nvm.sh" ] &amp;&amp; . "$NVM_DIR/nvm.sh"
- nvm install $NODE_VERSION
- nvm use $NODE_VERSION

- npm install -g react-native-cli
- npm install -g detox-cli

</span><span class="hljs-attr">script:</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">detox</span> <span class="hljs-string">build</span> <span class="hljs-bullet">--configuration</span> <span class="hljs-string">ios.sim.release</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">detox</span> <span class="hljs-string">test</span> <span class="hljs-bullet">--configuration</span> <span class="hljs-string">ios.sim.release</span> <span class="hljs-bullet">--cleanup</span>

</code></pre>
<h3><a class="anchor" aria-hidden="true" name="running-detox-on-bitrise-https-wwwbitriseio"></a><a href="#running-detox-on-bitrise-https-wwwbitriseio" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>• Running Detox on <a href="https://www.bitrise.io/">Bitrise</a></h3>
<p>Bitrise is a popular CI service for automating React Native apps. If you are looking to get started with Bitrise, check out <a href="http://blog.bitrise.io/2017/07/25/how-to-set-up-a-react-native-app-on-bitrise.html">this</a> guide.</p>
<p>You can run Detox on Bitrise by creating a new workflow. Below is an example of the Bitrise <strong>.yml</strong> file for a workflow called <code>tests</code>.</p>
<p>Additionally, you can use a <a href="http://devcenter.bitrise.io/webhooks/">webhook</a> on Bitrise to post the build status directly into your Slack channel.</p>
<pre><code class="hljs css yml"><span class="hljs-meta">---</span>
<span class="hljs-attr">format_version:</span> <span class="hljs-number">1.1</span><span class="hljs-number">.0</span>
<span class="hljs-attr">default_step_lib_source:</span> <span class="hljs-attr">https://github.com/bitrise-io/bitrise-steplib.git</span>
<span class="hljs-attr">trigger_map:</span>
<span class="hljs-attr">- push_branch:</span> <span class="hljs-string">"*"</span>
<span class="hljs-attr">  workflow:</span> <span class="hljs-string">tests</span>
<span class="hljs-attr">workflows:</span>
<span class="hljs-attr">  _tests_setup:</span>
<span class="hljs-attr">    steps:</span>
<span class="hljs-attr">    - activate-ssh-key:</span> <span class="hljs-string">{}</span>
<span class="hljs-attr">    - git-clone:</span>
<span class="hljs-attr">        inputs:</span>
<span class="hljs-attr">        - clone_depth:</span> <span class="hljs-string">''</span>
<span class="hljs-attr">        title:</span> <span class="hljs-string">Git</span> <span class="hljs-string">Clone</span> <span class="hljs-string">Repo</span>
<span class="hljs-attr">    - script:</span>
<span class="hljs-attr">        inputs:</span>
<span class="hljs-attr">        - content:</span> <span class="hljs-string">|-</span>
            <span class="hljs-comment">#!/bin/bash</span>

            <span class="hljs-string">npm</span> <span class="hljs-string">cache</span> <span class="hljs-string">verify</span>

            <span class="hljs-string">npm</span> <span class="hljs-string">install</span>
<span class="hljs-attr">        title:</span> <span class="hljs-string">Install</span> <span class="hljs-string">NPM</span> <span class="hljs-string">Packages</span>
<span class="hljs-attr">    before_run:</span>
<span class="hljs-attr">    after_run:</span>
<span class="hljs-attr">  _detox_tests:</span>
<span class="hljs-attr">    before_run:</span> <span class="hljs-string">[]</span>
<span class="hljs-attr">    after_run:</span> <span class="hljs-string">[]</span>
<span class="hljs-attr">    steps:</span>
<span class="hljs-attr">    - npm:</span>
<span class="hljs-attr">        inputs:</span>
<span class="hljs-attr">        - command:</span> <span class="hljs-string">install</span> <span class="hljs-bullet">-g</span> <span class="hljs-string">detox-cli</span>
<span class="hljs-attr">        title:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Detox</span> <span class="hljs-string">CLI</span>
<span class="hljs-attr">    - npm:</span>
<span class="hljs-attr">        inputs:</span>
<span class="hljs-attr">        - command:</span> <span class="hljs-string">install</span> <span class="hljs-bullet">-g</span> <span class="hljs-string">react-native-cli</span>
<span class="hljs-attr">        title:</span> <span class="hljs-string">Install</span> <span class="hljs-string">React</span> <span class="hljs-string">Native</span> <span class="hljs-string">CLI</span>
<span class="hljs-attr">    - script:</span>
<span class="hljs-attr">        inputs:</span>
<span class="hljs-attr">        - content:</span> <span class="hljs-string">|-</span>
            <span class="hljs-comment">#!/bin/bash</span>

            <span class="hljs-string">brew</span> <span class="hljs-string">tap</span> <span class="hljs-string">wix/brew</span>
            <span class="hljs-string">brew</span> <span class="hljs-string">install</span> <span class="hljs-string">applesimutils</span>
<span class="hljs-attr">        title:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Detox</span> <span class="hljs-string">Utils</span>
<span class="hljs-attr">    - script:</span>
<span class="hljs-attr">        inputs:</span>
<span class="hljs-attr">        - content:</span> <span class="hljs-string">|-</span>
            <span class="hljs-comment">#!/bin/bash</span>

            <span class="hljs-string">detox</span> <span class="hljs-string">build</span> <span class="hljs-bullet">--configuration</span> <span class="hljs-string">ios.sim.release</span>
<span class="hljs-attr">        title:</span> <span class="hljs-string">Detox</span> <span class="hljs-bullet">-</span> <span class="hljs-string">Build</span> <span class="hljs-string">Release</span> <span class="hljs-string">App</span>
<span class="hljs-attr">    - script:</span>
<span class="hljs-attr">        inputs:</span>
<span class="hljs-attr">        - content:</span> <span class="hljs-string">|-</span>
            <span class="hljs-comment">#!/bin/bash</span>

            <span class="hljs-string">detox</span> <span class="hljs-string">test</span> <span class="hljs-bullet">--configuration</span> <span class="hljs-string">ios.sim.release</span> <span class="hljs-bullet">--cleanup</span>
<span class="hljs-attr">        title:</span> <span class="hljs-string">Detox</span> <span class="hljs-bullet">-</span> <span class="hljs-string">Run</span> <span class="hljs-string">E2E</span> <span class="hljs-string">Tests</span>
<span class="hljs-attr">  tests:</span>
<span class="hljs-attr">    before_run:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">_tests_setup</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">_detox_tests</span>
<span class="hljs-attr">    after_run:</span> <span class="hljs-string">[]</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/detox/" class="nav-home"></a><div><h5>Docs</h5><a href="/detox/docs/en/Introduction.GettingStarted.html">Getting Started</a><a href="/detox/docs/en/Guide.Contributing.html">Contributing</a></div><div><h5>Community</h5><a href="/detox/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/detox" target="_blank">Stack Overflow</a></div><div><h5>More</h5><a href="https://github.com/wix/detox">GitHub</a><a class="github-button" href="https://github.com/wix/detox" data-icon="octicon-star" data-count-href="/wix/detox/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2018 Wix.com Ltd.</section></footer></div></body></html>